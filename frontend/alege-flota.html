<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Alege Flota</title>
    <style>
        /* Stiluri de bază, preluate din conversația anterioară */
        body { background-color: #2c3e50; color: white; font-family: sans-serif; text-align: center; }
        .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; }
        .ship-card { border: 2px solid #e67e22; border-radius: 10px; padding: 10px; width: 200px; cursor: pointer; transition: 0.3s; background: #34495e; box-sizing: border-box;}
        .ship-card:hover { transform: scale(1.05); }
        .selected { border-color: #2ecc71; background-color: #27ae60; box-shadow: 0 0 15px #2ecc71; }
        img { width: 100%; height: auto; border-radius: 5px; }
    </style>
</head>
<body>

<h1>Alege 4 Nave pentru Luptă!</h1>
<h3 id="count-display">Selectate: 0 / 4</h3>

<div class="container" id="ships-container">
    <p>Se încarcă navele...</p>
</div>

<button onclick="saveLoadout()" style="margin-top: 20px; padding: 15px 30px; background: #e67e22; border: none; color: white; font-size: 18px; cursor: pointer;">SALVEAZĂ FLOTA</button>

<script>
    const API_BASE_URL = 'http://localhost:8080';
    let selectedShips = [];

    // 1. Cand se deschide pagina, cerem datele de la Java
    window.onload = async function() {
        try {
            // Folosim adresa ABSOLUTA
            const response = await fetch(`${API_BASE_URL}/api/ships`);

            if (!response.ok) {
                throw new Error(`Eroare HTTP: ${response.status}`);
            }

            const ships = await response.json();
            displayShips(ships);

        } catch (error) {
            console.error("Eroare la incarcare:", error);
            document.getElementById('ships-container').innerHTML =
                `<p style="color: #e74c3c;">❌ Eroare la conexiune. Verifică dacă Spring Boot rulează.</p>`;
        }
    };

    // 2. Functia care deseneaza cartonașele
    function displayShips(ships) {
        const container = document.getElementById('ships-container');
        container.innerHTML = '';

        ships.forEach(ship => {
            const card = document.createElement('div');
            card.className = 'ship-card';
            card.onclick = () => toggleSelection(card, ship.id);

            card.innerHTML = `
                    <img src="${ship.imageUrl}" alt="${ship.name}">
                    <h3>${ship.name}</h3>
                    <p>Mărime: ${ship.size} pătrățele</p>
                `;

            container.appendChild(card);
        });
    }

    // 3. Logica de selectie (Click pe nava)
    function toggleSelection(cardElement, shipId) {
        if (selectedShips.includes(shipId)) {
            selectedShips = selectedShips.filter(id => id !== shipId);
            cardElement.classList.remove('selected');
        } else {
            if (selectedShips.length >= 4) {
                alert("Poți alege maxim 4 nave!");
                return;
            }
            selectedShips.push(shipId);
            cardElement.classList.add('selected');
        }

        document.getElementById('count-display').innerText = `Selectate: ${selectedShips.length} / 4`;
    }

    // 4. Salvarea (Trimite datele la Spring Boot)
    async function saveLoadout() {
        if (selectedShips.length !== 4) {
            alert("Te rog alege exact 4 nave înainte să pleci la luptă!");
            return;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/api/ships/loadout`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(selectedShips)
            });

            const result = await response.text();

            if (response.ok) {
                alert("Flota salvată cu succes!");
                // Redirecționarea către pagina de așezare (Arena)
                window.location.href = 'game.html';
            } else {
                alert(`Eroare la salvare: ${result}`);
            }

        } catch (error) {
            console.error("Eroare la trimiterea datelor:", error);
            alert("Eroare de rețea. Serverul Java nu răspunde.");
        }
    }
</script>

</body>
</html>