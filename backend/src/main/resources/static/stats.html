<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Battle Boats - Statistici</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .stats-card {
            background: #34495e;
            border-radius: 14px;
            padding: 22px;
            width: min(520px, calc(100% - 32px));
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .stat {
            background: #2c3e50;
            border: 1px solid rgba(236,240,241,0.12);
            border-radius: 12px;
            padding: 14px;
        }

        .stat .label { color: #bdc3c7; font-size: 0.95em; }
        .stat .value { font-size: 1.9em; font-weight: 800; margin-top: 6px; }

        #error {
            color: #e74c3c;
            margin-top: 14px;
            font-weight: bold;
        }
    </style>
</head>
<body class="centered-layout">

<div class="stats-card">
    <button onclick="window.location.href='menu.html'" class="btn-back">‚¨Ö √énapoi la Meniu</button>
    <h1 style="margin: 12px 0 4px 0;">üìä Statistici</h1>
    <p id="subtitle" style="color:#bdc3c7; margin: 0;">Se √ÆncarcƒÉ...</p>

    <div class="stats-grid" id="stats">
        <div class="stat"><div class="label">Meciuri jucate</div><div class="value" id="gamesPlayed">-</div></div>
        <div class="stat"><div class="label">Meciuri c√¢»ôtigate</div><div class="value" id="wins">-</div></div>
        <div class="stat"><div class="label">Meciuri pierdute</div><div class="value" id="losses">-</div></div>
        <div class="stat"><div class="label">Win rate</div><div class="value" id="winRate">-</div></div>
    </div>

    <div id="error"></div>
</div>

<script src="config.js"></script>
<script>
    const API_BASE_URL = window.API_BASE_URL;

    const connectedUser = localStorage.getItem('connectedUser');
    if (!connectedUser) {
        window.location.href = 'index.html';
    }

    async function loadStats() {
        document.getElementById('subtitle').innerText = `Pentru contul: ${connectedUser}`;

        try {
            // DB userId
            const userResp = await fetch(`${API_BASE_URL}/api/auth/user/${connectedUser}`);
            if (!userResp.ok) throw new Error('Nu pot √ÆncƒÉrca user-ul logat');
            const user = await userResp.json();

            const statsResp = await fetch(`${API_BASE_URL}/api/stats/${user.id}`);
            if (!statsResp.ok) {
                const body = await statsResp.text();
                throw new Error(`Nu pot √ÆncƒÉrca statisticile (HTTP ${statsResp.status}): ${body}`);
            }
            const stats = await statsResp.json();

            document.getElementById('gamesPlayed').innerText = stats.gamesPlayed;
            document.getElementById('wins').innerText = stats.wins;
            document.getElementById('losses').innerText = (typeof stats.losses === 'number') ? stats.losses : (stats.gamesPlayed - stats.wins);
            document.getElementById('winRate').innerText = `${Number(stats.winRate).toFixed(1)}%`;
        } catch (e) {
            console.error(e);
            document.getElementById('error').innerText = `‚ùå ${e.message}`;
        }
    }

    loadStats();
</script>

</body>
</html>
